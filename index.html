<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tool Report Calculating</title>
    <link rel="icon" href="logo.png" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="d-flex justify-content-center align-items-center min-vh-100">
      <div class="card shadow p-2 w-100" style="max-width: 500px">
        <h2 class="text-center">TOOL REPORT CALCULATING</h2>
        <p class="pb-5 text-center">created by ATF</p>

        <form id="formHitung" class="border rounded shadow p-4 bg-white">
          <div class="mb-3">
            <label for="spend" class="form-label w-100"
              >SPEND ADS:
              <input type="number" class="form-control" id="spend" required
            /></label>
          </div>
          <div class="mb-3">
            <label for="lead_scalev" class="form-label w-100"
              >LEAD SCALEV:
              <input
                type="number"
                class="form-control"
                id="lead_scalev"
                required
            /></label>
          </div>
          <div class="mb-3">
            <label for="lead_real" class="form-label w-100"
              >LEAD REAL:
              <input type="number" class="form-control" id="lead_real" required
            /></label>
          </div>
          <div class="mb-3">
            <label for="omset" class="form-label w-100"
              >OMSET:
              <input type="number" class="form-control" id="omset" required
            /></label>
          </div>
          <div class="mb-2">
            <button
              type="submit"
              class="btn btn-primary w-100"
              onclick="scroll"
              id="scrollButton"
            >
              Hitung
            </button>
          </div>
          <div class="mb-3">
            <button
              type="submit"
              class="btn btn-warning w-100"
              onclick="reloadPage()"
            >
              Refresh
            </button>
          </div>
        </form>
        <div class="mt-4 border rounded shadow p-4 bg-white">
          <h3 id="hasil">Hasil:</h3>
          <pre id="output" class="border rounded-1 p-3">Belum ada hasil.</pre>
          <button onclick="salinHasil()" class="btn btn-success w-100">
            Salin Hasil
          </button>
        </div>
      </div>
    </div>

    <script>
      let teksTersusun = ""; // Disimpan global agar bisa disalin

      function reloadPage() {
        location.reload();
      }

      const button = document.getElementById("scrollButton");
      button.addEventListener("click", () => {
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
      });

      function formatTanggalSekarang() {
        const hariList = [
          "Minggu",
          "Senin",
          "Selasa",
          "Rabu",
          "Kamis",
          "Jumat",
          "Sabtu",
        ];

        let today = new Date();
        let jam = today.getHours();
        let menit = today.getMinutes();

        // Kondisi khusus jam 00:00 - 07:00
        if (jam >= 0 && jam < 8) {
          // Geser tanggal ke kemarin
          today.setDate(today.getDate() - 1);
          const hari = hariList[today.getDay()];
          const tanggal = String(today.getDate()).padStart(2, "0");
          const bulan = String(today.getMonth() + 1).padStart(2, "0");
          const tahun = today.getFullYear();
          return `${hari}, ${tanggal}/${bulan}/${tahun} 24 jam`;
        }

        // Kondisi 08:00 – 10:00 → 08:30
        if (jam >= 8 && jam < 10) {
          jam = 8;
          menit = 30;
        }
        // Kondisi 11:00 – 14:00 → 11:30
        else if (jam >= 11 && jam < 14) {
          jam = 11;
          menit = 30;
        }
        // Kondisi 15:55 – 18:00 → 16:00
        else if ((jam === 15 && menit >= 55) || (jam >= 16 && jam < 18)) {
          jam = 16;
          menit = 0;
        }
        // Kondisi 20:55 – 23:59 → 21:00
        else if ((jam === 20 && menit >= 55) || (jam > 20 && jam <= 23)) {
          jam = 21;
          menit = 0;
        }

        // Format hari dan tanggal
        const hari = hariList[today.getDay()];
        const tanggal = String(today.getDate()).padStart(2, "0");
        const bulan = String(today.getMonth() + 1).padStart(2, "0");
        const tahun = today.getFullYear();
        const jamStr = String(jam).padStart(2, "0");
        const menitStr = String(menit).padStart(2, "0");

        return `${hari}, ${tanggal}/${bulan}/${tahun} | ${jamStr}:${menitStr}`;
      }

      // Tangkap form submit
      document
        .getElementById("formHitung")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          // Ambil nilai dari input dan konversi ke angka
          const spend = parseFloat(document.getElementById("spend").value);
          const lead_scalev = parseFloat(
            document.getElementById("lead_scalev").value
          );
          const lead_real = parseFloat(
            document.getElementById("lead_real").value
          );
          const omset = parseFloat(document.getElementById("omset").value);

          // Siapkan hasil
          const hasilList = [
            ["Spend Ads", spend.toLocaleString("id-ID")],
            ["Lead SCALEV", lead_scalev],
            [
              "CPL SCALEV",
              Number((spend / lead_scalev).toFixed(0)).toLocaleString("id-ID"),
            ],
            ["LEAD Real", lead_real],
            [
              "CPL Real",
              Number((spend / lead_real).toFixed(0)).toLocaleString("id-ID"),
            ],
            [
              "Spend + PPN",
              Number((spend + spend * 0.04).toFixed(0)).toLocaleString("id-ID"),
            ],
            ["Omset", omset.toLocaleString("id-ID")],
            ["ROAS", (omset / (spend + spend * 0.04)).toFixed(2)],
          ];

          // Hitung panjang label terpanjang
          const maxLabelLength = Math.max(
            ...hasilList.map(([label]) => label.length)
          );

          const tanggal = formatTanggalSekarang(); // fungsi sudah dijelaskan sebelumnya

          const teksTersusun = hasilList
            .map(([label, nilai]) => {
              const labelRapi = label.padEnd(maxLabelLength, " ");
              const baris = `${labelRapi} = ${nilai}`;

              // Tambahkan baris kosong setelah "CPL Real"
              if (label === "CPL Real") {
                return `${baris}\n`;
              }

              return baris;
            })
            .join("\n");

          // Gabungkan TANGGAL di atas hasil
          const teksGabungan = `${tanggal}\n\n${teksTersusun}`;

          // Tampilkan ke <pre>
          document.getElementById("output").textContent = teksGabungan;
        });

      // Fungsi salin
      function salinHasil() {
        const teks = document.getElementById("output").textContent;
        navigator.clipboard
          .writeText(teks)
          .then(() => alert("Hasil dan tanggal disalin ke clipboard!"))
          .catch((err) => alert("Gagal menyalin: " + err));
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
